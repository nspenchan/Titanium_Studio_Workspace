function History(win, title, bgColor, dbName, arrayPurchase, arrayLevel, db, db1, label02) {
	var top = 0;
	var arrayId = [];
	var level = Titanium.App.Properties.getString('level');
	var column = Titanium.App.Properties.getString('column');
	var question = Titanium.App.Properties.getString('question');
	var answer = Titanium.App.Properties.getString('answer');
	var column = Titanium.App.Properties.getString('column');
	var i, j, row, stars, corrects, label, leftImage, backgroundColor, select, select1, data, data1
		, index, rowId, questionArray, answerArray, correctArray, starsArray;
	var arrayRecord = [];
	
	if(Ti.Platform.osname=='android'){
		var osname = Ti.Platform.osname,
		height = Ti.Platform.displayCaps.platformHeight / Ti.Platform.displayCaps.logicalDensityFactor,
		width = Ti.Platform.displayCaps.platformWidth / Ti.Platform.displayCaps.logicalDensityFactor;
	}else{
		var osname = Ti.Platform.osname,
		height = Ti.Platform.displayCaps.platformHeight,
		width = Ti.Platform.displayCaps.platformWidth;
	}
	//create object instance, a parasitic subclass of Observable
	var self = Ti.UI.createView({
		backgroundColor:'#000',
	});
	
	function scale(dimension) {
		return Math.round(dimension *  Ti.App.Properties.getDouble('osZoom') * Ti.App.Properties.getDouble('selfZoom') * Ti.Platform.displayCaps.platformWidth / 320);
	}
	
	var view = Titanium.UI.createView({
		width:Ti.UI.FILL,
	    height:scale(60),
	    top:top,
	});
	self.add(view);
	
	var label = Titanium.UI.createLabel({
		color:'#fff',
		backgroundColor:bgColor,
		text:L(title),
		font:{fontSize:scale(25),fontFamily:'Helvetica Neue',fontWeight:'bold'},
		textAlign:'center',
		width:Ti.UI.FILL,
	    height:scale(60),
	    top:top,
	});
	view.add(label);
	
	if(scale(90)>width/2-10){
		var buttonWidth = width/2-10;
	}else{
		var buttonWidth = scale(90);
	}
	
	var solve = Ti.UI.createButton({
		color:'#fff',
		backgroundColor:bgColor,
		backgroundImage: '/assets/images/gray300x300_0.4.png',
		title: L('Solve'),
		font:{fontSize:scale(20),fontFamily:'Helvetica Neue',fontWeight:'bold'},
		textAlign : 'center',
		height:scale(60),
		width:buttonWidth,
		right:scale(0),
		borderColor:'#002400',
		borderWidth:scale(1),
		opacity:1,
	});
	view.add(solve);
		
	solve.addEventListener('click', function(e){
		var section = tableview.data[0];
		for(i=0; i<section.rows.length; i++){
			if(section.rows[i].check == 1){
				arrayId.push(level + ',' + section.rows[i].id + ',' + section.rows[i].question + ',' + section.rows[i].answer);
			}
		}
		Ti.API.info(arrayId);
		if(arrayId.length==0){
			alert(L('Select_Questions'));
		}else{
			//alert('arrayId[0]: ' + arrayId[0]);
			//db = Ti.Database.open(dbName);
			//db1 = Ti.Database.open('record_' + dbName);
    			//var arrayRecord = [];
    			//var bang = '';
			var Question = require('ui/common/Question');
			//construct UI
			var question = new Question(win, 'History_', bgColor, [], arrayId, -1, '', db, db1, '', label02);
			win.add(question);
			
			setTimeout(function(){
				win.remove(self);
			}, 100);
		}
	});
	
	var back = Ti.UI.createButton({
		color:'#fff',
		backgroundColor:bgColor,
		backgroundImage: '/assets/images/gray300x300_0.4.png',
		title: L('Back'),
		font:{fontSize:scale(20),fontFamily:'Helvetica Neue',fontWeight:'bold'},
		textAlign : 'center',
		height:scale(60),
		width:buttonWidth,
		left:scale(0),
		borderColor:'#002400',
		borderWidth:scale(1),
		opacity:1,
	});
	view.add(back);
		
	back.addEventListener('click', function(e){
		db.close();
		db1.close();
		setTimeout(function(){
			win.remove(self);
		}, 100);
	});
	
	var rows = [];
	
	if(Titanium.App.Properties.getString('recordIds')){
		var row = Ti.UI.createTableViewRow({
		    height:scale(60),
		    backgroundColor:'#ff7f7f',
		    hasChild:true,
		    id:'record',
		});
		
		var leftImage = Titanium.UI.createImageView({
		    image: '/assets/images/Bookmark.png',
		    left:0,
		    width:scale(48),
		});
		row.add(leftImage);
		
		var label = Titanium.UI.createLabel({
			color:'#000',
			backgroundColor:'transparent',
			text:L('History_Questions'),
			font:{fontSize:scale(24),fontFamily:'Helvetica Neue',fontWeight:'bold'},
			textAlign:'left',
			width:width-scale(100),
			height:'auto',
			left:scale(70),
			//opacity:0.7,
		});
		row.add(label);
		
		rows.push(row);
	}
	
	var row = Ti.UI.createTableViewRow({
	    height:scale(60),
	    backgroundColor:'gray',
	    id:'',
	});
		
	var labelTop = Titanium.UI.createLabel({
		color:'#000',
		backgroundColor:'transparent',
		text:L('Level') + ' ' + level,
		font:{fontSize:scale(24),fontFamily:'Helvetica Neue'},
		textAlign:'center',
		width:Ti.UI.FILL,
		height:'auto',
		//opacity:0.7,
	});
	row.add(labelTop);
	
	rows.push(row);
	
	questionArray = ['question']; 
	answerArray = ['answer'];
	correctArray = ['correct'];
	starsArray = ['stars'];

	select = 'SELECT ' + question + ', ' + answer + ' FROM hokudai_level' + level;
	Ti.API.info(select);
	data = db.execute(select);
	while(data.isValidRow()){
		if(data.field(0)){
			questionArray.push(data.field(0));
		}else{
			questionArray.push(L('undefined'));
		}
		if(data.field(1)){
			answerArray.push(data.field(1));
		}else{
			answerArray.push(L('undefined'));
		}
		data.next();
	}
	//Ti.API.info(questionArray);
	select1 = "SELECT " + column + "2, "+ column + "3 FROM hokudai_level" + level;
	data1 = db1.execute(select1);
	while(data1.isValidRow()){
		if(data1.field(0)){
			correctArray.push(data1.field(0));
		}else{
			correctArray.push('');
		}
		if(data1.field(1)){
			starsArray.push(data1.field(1));
		}else{
			starsArray.push('');
		}
		data1.next();
	}
	data.close();
	data1.close();

	for(i=1; i<=arrayLevel[level][0]; i++){
		corrects = correctArray[i] + '';
		//Ti.API.info(corrects);
		
		if(correctArray[i]){
			if(corrects.substr(-1,1)=='○' || corrects.substr(-1,1)=='◎' ){
				backgroundColor = 'green';
			}else if(corrects.substr(-1, 1)=='×'){
				backgroundColor = 'pink';
			}
		}else{
			corrects = L('Not_questions_yet');
			backgroundColor = 'white';
		}
		
		if(starsArray[i]){
			stars = starsArray[i];
		}else{
			stars = '';
		}
		
		//Ti.API.info(i);
		row = Ti.UI.createTableViewRow({
		    height:'auto',
		    backgroundColor:backgroundColor,
		    id:i,
		    question:question,
		    answer:answer,
		    check:0,
		});
		leftImage = Titanium.UI.createImageView({
		    image: '/assets/images/check-non.gif',
		    width:scale(48),
		    height:scale(48),
		    left:0,
		});
		row.add(leftImage);
		
		label = Titanium.UI.createLabel({
			color:'#000',
			backgroundColor:'transparent',
			text:L('Level') + ' ' + level + ' / ' + L('No_') + i + ' ' + stars + '\n' + questionArray[i] + ' / ' + answerArray[i] + '\n' + corrects,
			font:{fontSize:scale(18),fontFamily:'Helvetica Neue'},
			textAlign:'left',
			width:width-scale(60),
			height:'auto',
			left:scale(50),
			top:scale(10),
			bottom:scale(10),
			//opacity:0.7,
		});
		row.add(label);
		
		rows.push(row);
	}

	var tableview = Titanium.UI.createTableView({top: top+scale(60)});
	
	tableview.addEventListener('click', function(e){
		rowId = e.row.id;
		Ti.API.info(JSON.stringify(e));
		if(rowId=='record'){
			var History2 = require('ui/common/History2');
			//construct UI
			var history2 = new History2(win, 'Recent', '#ff7f7f', db, db1);
			win.add(history2);
			
			setTimeout(function(){
				win.remove(self);
			}, 100);
		}else if(rowId!=''){
		    var section = tableview.data[0];
			//for(i=0; i<section.rows.length; i++){
				//if(section.rows[i].id==e.row.id && e.row.id!=''){
					index = e.index;
					var children = section.rows[index].getChildren();
					//for(j=0; j<children.length; j++){
						if(children[0].image=='/assets/images/check-non.gif'){
							children[0].image = '/assets/images/check.gif';
							section.rows[index].check = 1;
						}else if(children[0].image=='/assets/images/check.gif'){
							children[0].image = '/assets/images/check-non.gif';
							section.rows[index].check = 0;
						}
					//}
				//}
			//}
		}
	});
	
    tableview.startLayout();
    tableview.setData(rows);
    tableview.finishLayout();
    
    self.add(tableview);
	
	return self;
}

module.exports = History;